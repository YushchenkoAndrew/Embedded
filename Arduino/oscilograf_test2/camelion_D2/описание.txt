Миниатюрный осциллограф Chameleon D.
Автор версии D: grott

Первоначальная версия прибора разрабатывалась автором - kotovasiya, как самостоятельный осциллографический пробник. Первоначальную версию прибора можно посмотреть по ссылке:
http://radiokot.ru/circuit/digital/measure/30/. В процессе обсуждений и доработок появилась новая версия прибора с возможностью подключения внешних приставок. Версии приборов, а так же его обсуждение можно посмотреть по ссылке: http://radiokot.ru/forum/viewtopic.php?f=25&t=19878
Хотел бы отметить уважаемого участника SSMix, который внёс большой вклад в совершенствование данного устройства. Внесённые им изменения можно посмотреть по ссылке: http://radiokot.ru/forum/viewtopic.php?f=25&t=19878&start=2800 и далее по форуму. Усовершенствованное им устройство получило название версии "Хамелеон D2". Архивы всех версий представлены на первой странице форума.  D2 - это изменённая топология платы и существенное изменение в программном обеспечении всего проекта. Схема осталась без изменений за исключением некоторых номиналов. Следующие прошивки только дорабатывали прошивку SSMix и могли называться D3, D4, D5 и т.д. Будем называть проект всё же Хамелеон_D независимо от версий плат D или D2. Прошивка одна и та же.


ВАЖНО!!!   
 МАКСИМАЛЬНОЕ напряжение без делителя - 100в !!!
                                                         С делителем до 500в.




Технические характеристики:    
Максимальная измеряемая частота 1МГц, 
            - пределы 0.5мкс, 1мкс, 2мкс, 5мкс, 10мкс, 20мкс, 50мкс, 100мкс, 200мкс, 500мкс, 1мс, 2мс, 5мс, 10мс, 20мс, 50мс, 100мс, максимальная частота дискретизации: 5 МГц.
1.	Минимальное измеряемое напряжение 50мв/дел, 
- пределы 50мв/дел, 100мв/дел, 200мв/дел, 500мв/дел, 1в/дел, 2в/дел, 5в/дел,  10в/дел. (с щупом 1:10 до 500в).
2.	Запуск развертки по фронту или по спаду: авто, однократный или внешним   
сигналом. 
      4.  Питание   3,7в, Li-Ion  батарея от мобильного телефона. 
      5.  Активное окно для осциллограммы 120*176 точек, LCD LS020. 
      6.  Заряд батареи через разъём miniUSB от адаптера с Uвых = 5,0в.

Кроме того добавлены следующие сервисные функции:
Автоматическое гашение подсветки (примерно через 30 секунд после последнего нажатия кнопок) производится:
- в сервисном меню;
- в меню анализа;
- в рабочем режиме, если нет сигнала более 30 секунд .
Автоматическое выключение питания (примерно через 15 минут):
- в сервисном меню, если не подключено внешнее питание или, если подключено и завершена зарядка аккумулятора;
- после гашения подсветки в остальных режимах.
При подключении внешнего питания (5В)  включается режим зарядки аккумулятора - зеленый значок батарейки меняет цвет на красный. После зарядки аккумулятора до напряжения 4.15 В процесс заряда прекращается и значок батарейки меняется на значок сетевой вилки - аккумулятор отключается и питание производится от внешнего источника (5В).

   Хотелось бы отметить, об особенности автоматического переключения скорости развертки.
Т.к. в Хамелеоне на отображаемую точку приходится всего одна выборка, при некоторых сочетаниях частоты сигнала и скорости развертки возникает стробоскопический эффект, приводящий к неправильным показаниям (занижение частоты отображаемого сигнала или как бы "растяжка" осциллограммы по горизонтали). Очень толково этот эффект описан на сайте http://Oscilloscop-dss31.narod2.ru. Так вот замечено, что в автоматическом режиме иногда устанавливается неправильная скорость развертки, при этом сигнал несколько дрожит или переключение развертки происходит непрерывно с одного предела на другой, причем на одном пределе сигнал растянут, а на другом сильно сжат. В таких случаях следует в пункте скорости развертки нажать одновременно кнопки ВВЕРХ и ВНИЗ. При этом регулировка начинается с самой высокой скорости развертки 0.5 мкс/дел. По мере уменьшения скорости, сигнал, как правило, захватывается правильно.  

Схема:  ( представлена в архиве, файлом .spl7.)
                   

               Прибор собран на ATmega32A-AU. Генератор контроллера работает от внешнего кварца 15МГц.  В алгоритме применён принцип сканирования сигнала, сначала оцифровывается сигнал и сохраняется в буфере статической памяти 300 ячеек, далее идет поиск синхронизации с последующим выведением информации на дисплей. 
   Питание прибора,  осуществляется от Li-ion аккумулятора  напряжением 3,7в, применяемого в мобильных телефонах. Заряд аккумулятора происходит от внешнего источника питания (адаптера),  с выходным напряжением 5в, через разъём miniUSB.  Для подключения адаптера используются контакты  j1 +5в и  j5 GND ("-", корпус). Стабилизация Uвых. адаптера, не критична. Главное, от внешнего БП требуется только не превышение напряжения свыше 5.6в, если больше, то сработает защита в Хамелеоне. Сам контроллер питается от батареи, т.е . нестабильным напряжением. Стабильное напряжение для аналоговой схемы обеспечивается стабилизатором LP3985 на +3В. Напряжение -3В получаем от параметрического стабилизатора, собранного на Q2,Q3 (опорное напряжение для стабилизатора -3В берётся от стабилизированного +3В), на который подаётся выпрямленное напряжение с преобразователя подсветки (около -9В). Стабилитрон на выходе, это защита от перенапряжения. Стабилизатор для дисплея нужен не только для правильного напряжения 2.8-3.0В, но и для отсечки помех по шине питания.  R12 стоит для ограничения по току при аварийном режиме.  Дроссели L3-L5, стоят в ФНЧ по питанию, чем больше номинал, тем лучше.  D1 обязательно на 4.7В, нужен для определения подключения внешнего питания. Защита осуществлена на предохранителе и D2 5V6 ( он должен быть мощным 1вт). В связи с тем, что контроллер не питается стабильным напряжением, амплитуда импульсов ШИМ для смещения луча тоже не стабильна. Что делаем? Укорачиваем импульсы ШИМ до 2.5В, т.е. меньше, чем питаем контроллер. Этим,  достигается стабильное напряжение для схемы смещения луча.  Алгоритм подзарядки как у обычного аккумулятора. При  достижении 4.15в  зарядка отключается (откл. Q4-Q5). Питание идёт от внешнего БП, через Q9. Контроль через R25-R26. Если напряжение выше 4.2в ничего не происходит, только загорается "вилочка". Автовыключение,  происходит, если на батарее,  меньше 3.1в,  Важно:  резисторы R25/R26 bat_info должны быть одинаковы. При заряде, в начале большой ток, ограниченный резистором R6, потом он падает до минимума (зависит от батареи) и выключается заряд по достижению установленного значения 4.15в.    Включение и контроль заряда возможен только при включенном приборе, зато можно работать и заряжать одновременно.  Различные режимы питания и заряда, отображаются на дисплее:  
-  Зелёный индикатор - внешний БП не подключен, питание от батарейки.
-  Красный - подключен БП, идёт зарядка.
-  Значок вилочки - два варианта: -  БП подключён и закончилась зарядка;
                                                           -  БП подключён и не подключена батарея;
              Через разъём miniUSB имеется возможность подключения дополнительных измерительных приставок. Обращаю внимание - контакты j2 и j3 НЕ для связи с компьютером, а для связи с контролёрами приставок.  Имеющиеся, разработанные приставки можно посмотреть по ссылкам:
1.	"Тестер стабилитронов как отдельный прибор, так и приставка к карманному осциллографу Хамелеон D" -  автор  Grott
-  статья - http://radiokot.ru/circuit/digital/measure/52/
- обсуждение на форуме -  http://radiokot.ru/forum/viewtopic.php?f=25&t=55467
2.	 "Термометр - приставка к Хамелеону" - автор Grott
- статья - http://radiokot.ru/circuit/digital/measure/72/
- обсуждение на форуме - http://www.radiokot.ru/forum/viewtopic.php?t=76490
3.	 "Щуп с делителем к "Хамелеону" своими руками" - автор ELcat
- статья - http://radiokot.ru/lab/hardwork/59/
- обсуждение на форуме - http://www.radiokot.ru/forum/viewtopic.php?t=59005
   К уже имеющимся приставкам, разрабатываются новые приставки. Об их появлении можно узнать на форуме сайта www.radiokot.ru , в разделе "статьи". Там же можно принять участие в обсуждении, как самого прибора, так и приставок к нему.
               Измерения производятся при помощи выносного щупа, подключаемого к разъёму J5. В качестве J5 применено гнездо  аудио - стерео, под штекер  Jack 3,5. Центральный контакт и корпус, используются для подключения исследуемого сигнала, средний контакт используется для подключения сигнала внешней синхронизации. Вход только Y. На средний контакт выведен ещё вход триггера. Режим внешней синхронизации, иногда требуется для исследования специфических сигналов. Если, при исследовании таких сигналов,  внешнего источника синхронизации нет, то получить устойчивое изображение невозможно.
              В основном используют внутреннюю синхронизацию. В этом случае исследуемое напряжение подается на генератор развертки. Исследуемое напряжение как бы "навязывает" свой период генератору развертки. Если при этом период собственных колебаний генератора развертки почти равен (или почти кратен) периоду колебаний исследуемого напряжения, то колебания генератора синхронизируются и происходят в такт с исследуемым напряжением. При внешней синхронизации, в отличие от внутренней, на генератор развертки  подается напряжение от внешнего источника сигнала по каналу "Y". Колебания генератора развертки синхронизируются с внешним сигналом. В приборе вход "внешней синхронизации" подключён при всех режимах синхронизации, кроме "авто", но используется крайне редко. 
                             На схеме обозначены две "земли", выделены чёрным цветом и красным цветом. В аналогово-цифровой технике две земли, которые соединяются в одной точке поближе к входному разъёму внешнего питания, в идеале на фильтрующем входном электролите. Красным цветом выделена аналоговая "земля".

              В приборе применён дисплей LS020, но есть возможность установки дисплея LPH8836. Дисплей в Хамелеоне работает в 8-битном режиме. LS020 сам по себе 8-битный, LPH8836 перекодируется в программе на 8-бит.  Для каждого дисплея имеется своя прошивка, в названии файла которой, отмечено для какого типа дисплея та или иная прошивка. Питание дисплея,  по ДШ, составляет 2.85в, если запитаем 2.8-3.3в,  ничего страшного не произойдёт. Отдельно от схемы питаем дисплей по причине отделения цифровых помех контроллера дисплея от аналога основной схемы. Вследствие чего можно применить LP3985-2.8  и LP3985-3.0, маркировка указана в Datasheet.
                               
               Дисплей можно приклеить двусторонним скотчем прямо к контролёру, или капнуть по краям платы термо-клеем или не приклеивать (отлично держится на плоском шлейфе в пределах корпуса).






            ОУ MCP6022 выбирался как самый доступный и дешёвый ОУ, можно заменить любым из подходящих по параметрам ОУ (совпадение по ножкам, высокое входное сопротивление, низкое напряжение смещения на входе,  Rail to Rail, питание 3В, усиление при более высокой частоте при единичном усилении),  по этим параметрам, хороши ОУ фирмы AD, но они на порядок дороже). D14, на входе ОУ лучше ставить BAV99, потому как этот диод имеет определённую ёмкость, определяющую общую входную ёмкость прибора. Какое-либо изменение влечёт за собой перерасчёт конденсаторов делителя.  R38\R43 регулируют общий Ку.
           С28, С30, С39, С41, С42  выравнивают АЧХ прибора, без них амплитуда измеряемого сигнала будет искажена до не узнаваемости на определённых частотах. Особо точно подбирать номиналы, от указанных на схеме,  не имеет смысла. Конденсаторы делителя сильно зависят от входной ёмкости прибора. Любое изменение разводки влечёт за собой изменение входной ёмкости. Поэтому сначала собирается плата без конденсаторов делителя, отлаживаем минус, включаем и меряем ёмкость на входе ОУ (3-я ножка). Вот это и будет С17 (он компенсирует входную ёмкость, им же и подстраиваем завалы фронтов), а дальше всё просто, берём калькулятор. В каждом разряде ёмкость обратно пропорциональна своему резистору. Если конкретно, то умножаем С17 соответственно на 2, 6, 18, 38, 78, 198 и 398.  Для согласования входа осциллографа с входом исследуемого устройства, применена последовательная согласующая ячейка, состоящая из R37, C17.  
          В приборе, для звуковой сигнализации применён зуммер - стандартный пьезо-элемент диаметром 20мм и толщиной 0.5мм. Выход  контролёра на пьезо-элемент одновременно является входом детектирования откл\вкл внешнего питания. При батарейном питании на входе контролёра, чёткая единица, а при включённом БП чёткого ноля уже нет из-за диода D4. Потому надо притягивать вход контроллера резистором, т.е. припаять параллельно пьезо-элементу R53 =  470 кОм - 1 МОм.
           L2 = 0uH, это ферритовая перемычка с нулевой индуктивностью, можно заменить проволочной перемычкой.
           D15, это шунтирующий диод Шоттки.  Дело в том, что приставка питается от батареи через R6, который, в зависимости от потребляемого тока приставки, подсаживает питание самой приставки до минимального значения. Устраняется, шунтированием R6 диодом Шоттки.

Функциональное назначение кнопок 
- Длительное (3-4 сек) нажатие на центральную кнопку S3  "Menu" - Включение. 
- При включении, удерживая среднюю кнопку S3 "Menu" и нижнюю кнопку  S4 "Down" ->  
  попадаем в сервисное меню, где можно настроить цвета, яркость и тон звукового сигнала. 
  Ещё раз нажимаем среднюю кнопку S3 "Menu"  -> переходим к рабочему режиму с 
  сохранением  изменённых настроек.
-  При включении, удерживая кнопку S3 "Menu"  и S5  "Up" ->  возвращаемся к настройкам по   
   умолчанию, так сказать, "сброс к заводским" настройкам.
- В рабочем режиме, перемещение по строке меню осуществляется кнопками S1 "Left" и S2 
  "Right".
   Изменение выбранного параметра осуществляется кнопками S5 "Up" и S4 "Down",  (кроме 
   режима выбора синхронизации, в котором кнопка  S4 "Down"  служит для захвата 
   синхронизации в ждущем режиме).
- В рабочем режиме,  кратковременное нажатие средней кнопки S3 "Menu" -> переводит в режим 
  анализа сигнала, где кнопкой S4 "Down"  выбираем начальный и конечный маркеры, 
  перемещаем маркеры кнопками  S1 "Left" и S2 "Right". 
  Выход из режима анализа сигнала, осуществляется средней кнопкой S3 "Menu". 
- В пункте "чувствительность",  одновременным нажатием кнопок  S5 "Up" и S4 "Down",  
  производится включение режима автоматического переключения чувствительности.
  Отмена автоматического режима, производится этими же кнопками или изменением 
  чувствительности вручную. В автомате перед величиной чувствительности выводится значок "*".
- В пункте "скорость развертки", одновременным нажатием кнопок S5 "Up" и S4 "Down", 
  производится включение режима автоматического переключения скорости в диапазоне 
  0.5 мкс/дел. … 10мс/дел..  В автоматическом режиме перед показаниями  скорости развёртки  
  выводится  значок "*".
  Отмена режима автоматического переключения скорости, производится этими же кнопками или
 изменением скорости развёртки вручную.
- В пункте "смещение луча", одновременным нажатием кнопок S5 "Up" и S4 "Down", 
  возвращаемся в позицию , сохранённую в памяти перед последним выключением.
- Длительное (2-3сек) нажатием средней кнопки S3 "Menu" -> Выключение.

Плата и монтаж. (представлена в архиве файлом .lay) 
          Устройство собрано на  плате, из двухстороннего фольгированного стеклотекстолита, размером 38х90 мм. Плату можно изготовить как методом ЛУТ, так и с помощью фоторезиста. Так же можно заказать набор у автора указанной модификации прибора (см. форум). При помощи сухого плёночного фоторезиста, можно сделать маску в домашних условиях. 
       
               После травления и промывки платы, проверяем её на целостность дорожек (подтравы) и возможные замыкания дорожек (не протравы). Перед пайкой SMD компонентов, плату желательно залудить тонким слоем припоя. Сделать это можно следующим образом: - зачистить плату шлифовочной наждачной бумагой и промыть, затем  покрыть флюсом всю плату при помощи кисточки. Затем надо взять кусочек оплётки от экранированного провода, окунуть его в флюс, положить сверху кусочек припоя и нагреть паяльником, чтобы припой впитался в оплётку. Положить пропитанную припоем оплётку на плату и прогревая паяльником, водить по медным проводникам платы. При таком лужении слой получается тонкий и равномерный, что удобно при пайке SMD компонентов. Припой лучше использовать с низкой температурой плавления, и не перегревать проводники паяльником, чтобы не отклеились от стеклотекстолита (это в большей степени зависит от качества стеклотекстолита.
          Для пайки SMD компонентов желательно использовать паяльник с термостабилизацией и гальванической развязкой, а так же со снятием статического потенциала. Особенно при пайке активных компонентов.
          Монтаж компонентов  желательно производить по узлам. Начинаем с цепей питания. Сначала паяем  пассивные компоненты.  Затем паяем диоды, стабилитроны, припаиваем  микросхемы и транзисторы. Затем припаиваем "обвеску" IC2, IC3, IC4, IC7, соблюдая ту же последовательность - пассивные, активные компоненты. Затем паяем микросхемы. Далее паяем "обвеску" контролёра и сам контролёр, а так же шлейф для программатора. При желании шлейф для программирования можно вывести на разъём, и закрепить его  на корпусе устройства.
На плате много мест, где контактные площадки для пайки компонентов, расположены вплотную. Чтобы не перегревать компоненты, надо припаять выводы, которые не примыкают к контактам других компонентов, а затем припаять сразу два вывода компонентов, расположенных  вплотную  друг к другу. Аналогично паяем и микросхемы, сначала припаиваем ножки, которые не примыкают к выводам компонентов, затем паяем те ножки, которые примыкают к выводам компонентов вплотную. Таким образом, пропаиваем сразу два вывода разных компонентов, не перегревая их лишний раз. Монтаж получается ровный. Промываем тщательно плату и производим визуальный осмотр на предмет остатков припоя, флюса, замыканий, не пропаянных мест. Проверяем все цепи питания на отсутствие коротких замыканий.  Припаиваем шлейф к дисплею и к плате.  Желательно закрепить шлейф дисплея на самом дисплее и на плате, одной-двумя каплями термоклея.
           Подключаем программатор и программируем контролёр. 
          В последнюю очередь паяем кнопки и разъёмы. Места под кнопками и разъёмами должны быть тщательно очищены от припоя и флюса. На указанные посадочные места, хорошо подходят кнопки SWT-30, но у них короткий щтифт (проще говоря, толкатель), и они годятся под декоративную накладку, например как от пульта ДУ. 
При применении кнопок SWT-34, их выводы необходимо подрезать или подогнуть под кнопку.  При  подгибе можно незначительно регулировать высоту кнопок. 
          Проверяем наличие всех напряжений,  значение выходного напряжения стабилизатора -3в. Если необходимо, то вместо R4 впаиваем подстроечный резистор номиналом 15-20кОм, устанавливаем значение напряжения -3В, замеряем сопротивление и впаиваем  постоянный резистор нужного номинала.
          Включаем прибор, должна произойти инициализация дисплея и изображение заставки.  


Исходники.
Кто решил самостоятельно поработать с кодом программы, исходники "Хамелеона" на графическом ассемблере Algorithm Builder  http://www.algrom.net/russian.html можно найти по ссылке: http://radiokot.ru/forum/download/file.php?id=91801 

